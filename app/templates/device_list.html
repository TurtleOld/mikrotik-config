{% if message %}
<div class="message message-success">{{ message }}</div>
{% endif %}
{% if error %}
<div class="message message-error">{{ error }}</div>
{% endif %}

{% if devices %}
<h2 style="margin-top: 30px; margin-bottom: 20px;">Устройства ({{ devices|length }})</h2>
{% for device in devices %}
<div class="device-card">
    <div class="device-header">
        <div>
            <strong>
                {% if device.data and device.data.identity and device.data.identity.name %}
                    {{ device.data.identity.name }}
                {% else %}
                    {{ device.ip_address }}:{{ device.port }}
                {% endif %}
            </strong>
            <div class="device-info">
                {% if device.data and device.data.identity and device.data.identity.name %}
                    IP: {{ device.ip_address }}:{{ device.port }}<br>
                {% endif %}
                ID: {{ device.id }}<br>
                Добавлено: {{ device.created_at.strftime('%d.%m.%Y %H:%M:%S') }}
                {% if device.last_accessed %}
                <br>Последний доступ: {{ device.last_accessed.strftime('%d.%m.%Y %H:%M:%S') }}
                {% endif %}
            </div>
        </div>
        <div class="device-actions">
            <button 
                hx-get="/devices/{{ device.id }}" 
                hx-target="#device-detail" 
                hx-swap="innerHTML"
                class="btn-secondary">
                Просмотр
            </button>
            <button 
                hx-delete="/devices/{{ device.id }}" 
                hx-target="#device-list" 
                hx-swap="outerHTML"
                hx-confirm="Вы уверены, что хотите удалить это устройство?"
                class="btn-danger">
                Удалить
            </button>
        </div>
    </div>
    {% if device.data %}
    <div class="data-section">
        <h3>Данные устройства</h3>
        {% if device.data.identity %}
        <div class="data-item">
            <span class="data-key">Имя:</span>
            <span class="data-value">{{ device.data.identity.name if device.data.identity.name else 'Не задано' }}</span>
        </div>
        {% endif %}
        {% if device.data.routerboard %}
        <div class="data-item">
            <span class="data-key">Модель:</span>
            <span class="data-value">
                {% if device.data.routerboard.model %}
                    {{ device.data.routerboard.model }}
                {% elif device.data.routerboard.board-name %}
                    {{ device.data.routerboard.board-name }}
                {% else %}
                    Неизвестно
                {% endif %}
            </span>
        </div>
        {% endif %}
        {% if device.data.system %}
        <div class="data-item">
            <span class="data-key">Версия RouterOS:</span>
            <span class="data-value">
                {% if device.data.system.version %}
                    {{ device.data.system.version }}
                {% else %}
                    Неизвестно
                {% endif %}
            </span>
        </div>
        {% endif %}
        {% if device.data.interfaces %}
        <div class="data-item">
            <span class="data-key">Интерфейсы:</span>
            <span class="data-value">{{ device.data.interfaces|length }} записей</span>
        </div>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endfor %}
{% else %}
<div style="text-align: center; padding: 40px; color: #666;">
    <p>Устройства не добавлены. Добавьте первое устройство, используя форму выше.</p>
</div>
{% endif %}

<div id="device-detail"></div>

